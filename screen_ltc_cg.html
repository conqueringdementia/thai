<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>แบบคัดกรองภาวะสมองเสื่อมของผู้สูงอายุ</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Sarabun', sans-serif;
            background-color: #f8f9fa;
            padding-bottom: 60px;
        }
        .form-container {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
        .form-section {
            margin-bottom: 30px;
        }
        .form-section h3 {
            color: #007bff;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .form-navigation {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: white;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            padding: 10px;
            display: flex;
            justify-content: space-between;
        }
        .form-check-label, .form-label {
            font-size: 14px;
        }
        .progress {
            height: 10px;
            margin-bottom: 20px;
        }
        .question-row {
            margin-bottom: 10px;
            padding: 8px;
            border-radius: 5px;
        }
        .question-row:nth-child(odd) {
            background-color: #f8f9fa;
        }
        .hidden {
            display: none;
        }
        .summary-container {
            margin-top: 20px;
            padding: 15px;
            background-color: #e9ecef;
            border-radius: 5px;
        }
        .header-logo {
            text-align: center;
            margin-bottom: 20px;
        }
        .header-logo img {
            max-width: 100px;
            height: auto;
        }
        .bold-score {
            font-weight: bold;
            color: #dc3545;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <div class="header-logo">
            <img src="https://via.placeholder.com/100" alt="Logo" />
            <h2 class="text-center">แบบคัดกรองภาวะสมองเสื่อมในระบบ LTC</h2>
        </div>
        
        <div class="progress">
            <div id="progress-bar" class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
        </div>
        
        <!-- Section 1: ข้อมูลทั่วไป -->
        <div id="section1" class="form-container form-section">
            <h3>ส่วนที่ 1: ข้อมูลทั่วไป</h3>
            <form id="form1">
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="elderlyName" class="form-label">ชื่อผู้สูงอายุ</label>
                        <input type="text" class="form-control" id="elderlyName" name="elderlyName" required>
                    </div>
                    <div class="col-md-6">
                        <label for="elderlySurname" class="form-label">นามสกุล</label>
                        <input type="text" class="form-control" id="elderlySurname" name="elderlySurname" required>
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="elderlyId" class="form-label">เลขบัตรประชาชน</label>
                        <input type="text" class="form-control" id="elderlyId" name="elderlyId" maxlength="13" pattern="[0-9]{13}" required>
                    </div>
                    <div class="col-md-6">
                        <label for="homeAddress" class="form-label">บ้านเลขที่</label>
                        <input type="text" class="form-control" id="homeAddress" name="homeAddress" required>
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-md-4">
                        <label for="moo" class="form-label">หมู่ที่</label>
                        <input type="text" class="form-control" id="moo" name="moo">
                    </div>
                    <div class="col-md-4">
                        <label for="hospitalName" class="form-label">รพ.สต./ศูนย์แพทย์</label>
                        <input type="text" class="form-control" id="hospitalName" name="hospitalName" required>
                    </div>
                    <div class="col-md-4">
                        <label for="district" class="form-label">อำเภอ</label>
                        <input type="text" class="form-control" id="district" name="district" required>
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="province" class="form-label">จังหวัด</label>
                        <input type="text" class="form-control" id="province" name="province" required>
                    </div>
                    <div class="col-md-6">
                        <label for="cgName" class="form-label">ชื่อ CG</label>
                        <input type="text" class="form-control" id="cgName" name="cgName" required>
                    </div>
                </div>
                <h4 class="mt-4">ข้อมูลส่วนบุคคลของผู้สูงอายุ</h4>
                <div class="mb-3">
                    <label class="form-label">1. เพศ</label>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="gender" id="male" value="ชาย" required>
                        <label class="form-check-label" for="male">ชาย</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="gender" id="female" value="หญิง">
                        <label class="form-check-label" for="female">หญิง</label>
                    </div>
                </div>
                <div class="mb-3">
                    <label for="birthYear" class="form-label">2. ปี พ.ศ. เกิด</label>
                    <input type="number" class="form-control" id="birthYear" name="birthYear" min="2400" max="2568" required>
                </div>
                <div class="mb-3">
                    <label class="form-label">3. ศาสนา</label>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="religion" id="buddhist" value="พุทธ" required>
                        <label class="form-check-label" for="buddhist">พุทธ</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="religion" id="christian" value="คริสต์">
                        <label class="form-check-label" for="christian">คริสต์</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="religion" id="islam" value="อิสลาม">
                        <label class="form-check-label" for="islam">อิสลาม</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="religion" id="otherReligion" value="อื่นๆ">
                        <label class="form-check-label" for="otherReligion">อื่น ๆ</label>
                    </div>
                    <div id="otherReligionDiv" class="mt-2 hidden">
                        <input type="text" class="form-control" id="otherReligionText" name="otherReligionText" placeholder="ระบุศาสนา">
                    </div>
                </div>
                <div class="mb-3">
                    <label class="form-label">4. สถานภาพสมรส</label>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="maritalStatus" id="single" value="โสด" required>
                        <label class="form-check-label" for="single">โสด</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="maritalStatus" id="married" value="คู่">
                        <label class="form-check-label" for="married">คู่</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="maritalStatus" id="widowed" value="หม้าย">
                        <label class="form-check-label" for="widowed">หม้าย</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="maritalStatus" id="divorced" value="หย่า, แยก">
                        <label class="form-check-label" for="divorced">หย่า, แยก</label>
                    </div>
                </div>
                <div class="mb-3">
                    <label class="form-label">5. ระดับการศึกษา</label>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="education" id="noEducation" value="ไม่ได้เรียน" required>
                        <label class="form-check-label" for="noEducation">ไม่ได้เรียน</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="education" id="elementary" value="ประถมศึกษา">
                        <label class="form-check-label" for="elementary">ประถมศึกษา</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="education" id="highSchool" value="มัธยมศึกษา">
                        <label class="form-check-label" for="highSchool">มัธยมศึกษา</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="education" id="bachelor" value="ปริญญาตรี ขึ้นไป">
                        <label class="form-check-label" for="bachelor">ปริญญาตรี ขึ้นไป</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="education" id="otherEducation" value="อื่นๆ">
                        <label class="form-check-label" for="otherEducation">อื่น ๆ</label>
                    </div>
                    <div id="otherEducationDiv" class="mt-2 hidden">
                        <input type="text" class="form-control" id="otherEducationText" name="otherEducationText" placeholder="ระบุการศึกษา">
                    </div>
                </div>
            </form>
        </div>
        
        <!-- Section 2: ประวัติสุขภาพ -->
        <div id="section2" class="form-container form-section hidden">
            <h3>ส่วนที่ 2: ประวัติสุขภาพ</h3>
            <form id="form2">
                <div class="question-row">
                    <div class="d-flex justify-content-between align-items-center">
                        <span>โรคความดันโลหิตสูง</span>
                        <div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="hypertension" id="noHypertension" value="0" required>
                                <label class="form-check-label" for="noHypertension">ไม่เป็น</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="hypertension" id="yesHypertension" value="1">
                                <label class="form-check-label" for="yesHypertension">เป็น</label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="question-row">
                    <div class="d-flex justify-content-between align-items-center">
                        <span>โรคเบาหวาน</span>
                        <div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="diabetes" id="noDiabetes" value="0" required>
                                <label class="form-check-label" for="noDiabetes">ไม่เป็น</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="diabetes" id="yesDiabetes" value="1">
                                <label class="form-check-label" for="yesDiabetes">เป็น</label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="question-row">
                    <div class="d-flex justify-content-between align-items-center">
                        <span>โรคหัวใจ</span>
                        <div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="heartDisease" id="noHeartDisease" value="0" required>
                                <label class="form-check-label" for="noHeartDisease">ไม่เป็น</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="heartDisease" id="yesHeartDisease" value="1">
                                <label class="form-check-label" for="yesHeartDisease">เป็น</label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mb-3">
                    <label class="form-label">ประวัติการสูบบุหรี่</label>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="smoking" id="neverSmoked" value="ไม่เคยสูบ" required>
                        <label class="form-check-label" for="neverSmoked">ไม่เคยสูบ</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="smoking" id="quitSmoking" value="เคยสูบแต่เลิกแล้ว">
                        <label class="form-check-label" for="quitSmoking">เคยสูบแต่เลิกแล้ว</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="smoking" id="currentlySmoking" value="ยังสูบอยู่">
                        <label class="form-check-label" for="currentlySmoking">ยังสูบอยู่</label>
                    </div>
                </div>
            </form>
        </div>
        
        <!-- Section 3: การประเมินความรู้ความเข้าใจ -->
        <div id="section3" class="form-container form-section hidden">
            <h3>ส่วนที่ 3: การประเมินความรู้ความเข้าใจ</h3>
            <form id="form3">
                <div class="question-row">
                    <label class="form-label">1. วันนี้เป็นวันอะไร</label>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="day" id="correctDay" value="1" required>
                        <label class="form-check-label" for="correctDay">ตอบถูก</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="day" id="incorrectDay" value="0">
                        <label class="form-check-label" for="incorrectDay">ตอบผิด</label>
                    </div>
                </div>
                <div class="question-row">
                    <label class="form-label">2. ปีนี้คือปี พ.ศ. อะไร</label>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="year" id="correctYear" value="1" required>
                        <label class="form-check-label" for="correctYear">ตอบถูก</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="year" id="incorrectYear" value="0">
                        <label class="form-check-label" for="incorrectYear">ตอบผิด</label>
                    </div>
                </div>
                <div class="question-row">
                    <label class="form-label">3. สามารถจำชื่อบุคคลในครอบครัวได้</label>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="memory" id="goodMemory" value="1" required>
                        <label class="form-check-label" for="goodMemory">จำได้</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="memory" id="poorMemory" value="0">
                        <label class="form-check-label" for="poorMemory">จำไม่ได้</label>
                    </div>
                </div>
            </form>
        </div>
        
        <!-- Section 4: การประเมินการทำงานในชีวิตประจำวัน -->
        <div id="section4" class="form-container form-section hidden">
            <h3>ส่วนที่ 4: การประเมินการทำงานในชีวิตประจำวัน</h3>
            <form id="form4">
                <div class="question-row">
                    <label class="form-label">1. สามารถรับประทานอาหารด้วยตนเอง</label>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="eating" id="independentEating" value="2" required>
                        <label class="form-check-label" for="independentEating">ทำได้เอง</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="eating" id="assistedEating" value="1">
                        <label class="form-check-label" for="assistedEating">ต้องช่วยบางส่วน</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="eating" id="dependentEating" value="0">
                        <label class="form-check-label" for="dependentEating">ทำไม่ได้</label>
                    </div>
                </div>
                <div class="question-row">
                    <label class="form-label">2. สามารถอาบน้ำด้วยตนเอง</label>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="bathing" id="independentBathing" value="2" required>
                        <label class="form-check-label" for="independentBathing">ทำได้เอง</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="bathing" id="assistedBathing" value="1">
                        <label class="form-check-label" for="assistedBathing">ต้องช่วยบางส่วน</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="bathing" id="dependentBathing" value="0">
                        <label class="form-check-label" for="dependentBathing">ทำไม่ได้</label>
                    </div>
                </div>
            </form>
        </div>
        
        <!-- Section 5: การประเมินพฤติกรรมและอารมณ์ -->
        <div id="section5" class="form-container form-section hidden">
            <h3>ส่วนที่ 5: การประเมินพฤติกรรมและอารมณ์</h3>
            <form id="form5">
                <div class="question-row">
                    <label class="form-label">1. มีอาการซึมเศร้าบ่อยครั้ง</label>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="depression" id="noDepression" value="0" required>
                        <label class="form-check-label" for="noDepression">ไม่มี</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="depression" id="yesDepression" value="1">
                        <label class="form-check-label" for="yesDepression">มี</label>
                    </div>
                </div>
                <div class="question-row">
                    <label class="form-label">2. มีพฤติกรรมก้าวร้าว</label>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="aggression" id="noAggression" value="0" required>
                        <label class="form-check-label" for="noAggression">ไม่มี</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="aggression" id="yesAggression" value="1">
                        <label class="form-check-label" for="yesAggression">มี</label>
                    </div>
                </div>
            </form>
        </div>
        
        <!-- Section 6: ภาระผู้ดูแล -->
        <div id="section6" class="form-container form-section hidden">
            <h3>ส่วนที่ 6: ภาระผู้ดูแล</h3>
            <form id="form6">
                <div class="question-row">
                    <label class="form-label">1. รู้สึกเครียดจากการดูแล</label>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="caregiverStress" id="noStress" value="0" required>
                        <label class="form-check-label" for="noStress">ไม่เครียด</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="caregiverStress" id="mildStress" value="1">
                        <label class="form-check-label" for="mildStress">เครียดเล็กน้อย</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="caregiverStress" id="highStress" value="2">
                        <label class="form-check-label" for="highStress">เครียดมาก</label>
                    </div>
                </div>
            </form>
        </div>
        
        <!-- Section 7: สรุปและยืนยัน -->
        <div id="section7" class="form-container form-section hidden">
            <h3>ส่วนที่ 7: สรุปและยืนยัน</h3>
            <div id="summary" class="summary-container"></div>
            <button type="button" class="btn btn-success mt-3" id="submitForm">ยืนยันและส่ง</button>
        </div>
        
        <!-- Navigation -->
        <div class="form-navigation">
            <button type="button" class="btn btn-secondary" id="prevBtn" disabled>ย้อนกลับ</button>
            <button type="button" class="btn btn-primary" id="nextBtn">ถัดไป</button>
        </div>
    </div>

    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script>
        let currentSection = 1;
        const totalSections = 7;
        let userId = '';
        const formData = {};
        const appsScriptUrl = 'https://script.google.com/macros/s/AKfycbzkXtMr3C7zj3vh5CPg9pErrwJVjG4_Yo2zS2zvH2VPc8-82ZI6n3eUdcLWdd6d-L0zfw/exec';

        // Initialize LINE LIFF
        liff.init({ liffId: '2007308455-on3Xdl8x' }).then(() => {
            if (!liff.isLoggedIn()) {
                liff.login();
            } else {
                liff.getProfile().then(profile => {
                    userId = profile.userId;
                    formData.userId = userId;
                }).catch(err => console.error('Error getting profile', err));
            }
        }).catch(err => console.error('LIFF initialization failed', err));

        // Show/Hide Sections
        function showSection(sectionNum) {
            document.querySelectorAll('.form-section').forEach(section => section.classList.add('hidden'));
            document.getElementById(`section${sectionNum}`).classList.remove('hidden');
            document.getElementById('progress-bar').style.width = `${(sectionNum / totalSections) * 100}%`;
            document.getElementById('prevBtn').disabled = sectionNum === 1;
            document.getElementById('nextBtn').textContent = sectionNum === totalSections ? 'สรุปผล' : 'ถัดไป';
        }

        // Validate Form
        function validateForm(formId) {
            const form = document.getElementById(formId);
            return form.checkValidity();
        }

        // Collect Form Data
        function collectFormData(formId) {
            const form = document.getElementById(formId);
            const data = new FormData(form);
            const sectionData = {};
            for (let [key, value] of data) {
                sectionData[key] = value;
            }
            formData[formId] = sectionData;
        }

        // Calculate Section Scores
        function calculateSectionScore(formId) {
            const data = formData[formId] || {};
            let score = 0;
            if (formId === 'form2') {
                score += parseInt(data.hypertension || 0) + parseInt(data.diabetes || 0) + parseInt(data.heartDisease || 0);
            } else if (formId === 'form3') {
                score += parseInt(data.day || 0) + parseInt(data.year || 0) + parseInt(data.memory || 0);
            } else if (formId === 'form4') {
                score += parseInt(data.eating || 0) + parseInt(data.bathing || 0);
            } else if (formId === 'form5') {
                score += parseInt(data.depression || 0) + parseInt(data.aggression || 0);
            } else if (formId === 'form6') {
                score += parseInt(data.caregiverStress || 0);
            }
            return score;
        }

        // Show Summary
        function showSummary() {
            const summaryDiv = document.getElementById('summary');
            let summaryHtml = '<h4>สรุปผล</h4>';
            for (let i = 1; i <= 6; i++) {
                const score = calculateSectionScore(`form${i}`);
                summaryHtml += `<p>ส่วนที่ ${i}: คะแนน <span class="bold-score">${score}</span></p>`;
            }
            summaryDiv.innerHTML = summaryHtml;
        }

        // Navigation Buttons
        document.getElementById('prevBtn').addEventListener('click', () => {
            if (currentSection > 1) {
                currentSection--;
                showSection(currentSection);
            }
        });

        document.getElementById('nextBtn').addEventListener('click', () => {
            if (currentSection < totalSections) {
                if (validateForm(`form${currentSection}`)) {
                    collectFormData(`form${currentSection}`);
                    currentSection++;
                    showSection(currentSection);
                    if (currentSection === totalSections) {
                        showSummary();
                    }
                } else {
                    document.getElementById(`form${currentSection}`).reportValidity();
                }
            }
        });

        // Submit Form
        document.getElementById('submitForm').addEventListener('click', () => {
            if (confirm('ยืนยันการส่งแบบสอบถาม?')) {
                fetch(appsScriptUrl, {
                    method: 'POST',
                    body: JSON.stringify(formData),
                    headers: { 'Content-Type': 'application/json' }
                })
                .then(response => response.json())
                .then(() => {
                    alert('ส่งแบบสอบถามสำเร็จ');
                    liff.closeWindow();
                })
                .catch(err => {
                    alert('เกิดข้อผิดพลาด: ' + err);
                });
            }
        });

        // Initial Section
        showSection(currentSection);
    </script>
</body>
</html>